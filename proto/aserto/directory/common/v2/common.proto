syntax = "proto3";

package aserto.directory.common.v2;

option go_package = "github.com/aserto-dev/go-directory/aserto/directory/common/v2;common"; 

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

message ObjectType {
    optional int32 id                                   = 1;    // internal object type id
    optional string name                                = 2;    // object type name (unique, lc-string)
    optional string display_name                        = 3;    // object type display name
    optional bool is_subject                            = 4;    // object type is a subject (user|group) (default false)
    optional int32 ordinal                              = 5;    // sort ordinal (default 0)
    optional uint32 status                              = 6;    // status flag bitmap (default 0)
    optional google.protobuf.Struct schema              = 10;   // object type schema definition (JSON)
    optional google.protobuf.Timestamp created_at       = 20;   // created at timestamp (UTC)
    optional google.protobuf.Timestamp updated_at       = 21;   // last updated timestamp (UTC)
    optional google.protobuf.Timestamp deleted_at       = 22;   // deleted timestamp (UTC)
    optional string hash                                = 23;   // object instance hash
}

message Permission {
    optional string id                                  = 1;    // internal permission id
    optional string name                                = 2;    // permission name (unique, cs-string)
    optional string display_name                        = 3;    // permission display name
    optional google.protobuf.Timestamp created_at       = 20;   // created at timestamp (UTC)
    optional google.protobuf.Timestamp updated_at       = 21;   // last updated timestamp (UTC)
    optional google.protobuf.Timestamp deleted_at       = 22;   // deleted timestamp (UTC)
    optional string hash                                = 23;   // object instance hash
}

message RelationType {
    optional int32 id                                   = 1;    // relation type id selector
    optional string name                                = 2;    // relation type name selector
    optional string object_type                         = 3;    // object type referenced by relation
    optional string display_name                        = 4;    // relation display name
    optional int32 ordinal                              = 5;    // sort ordinal (default 0)
    optional uint32 status                              = 6;    // status bitmap (default 0)
    repeated string unions                              = 7;    // relations union-ed with relation type instance
    repeated string permissions                         = 8;    // permissions associated to relation type instance
    optional google.protobuf.Timestamp created_at       = 20;   // created at timestamp (UTC)
    optional google.protobuf.Timestamp updated_at       = 21;   // last updated timestamp (UTC)
    optional google.protobuf.Timestamp deleted_at       = 22;   // deleted timestamp (UTC)
    optional string hash                                = 23;   // object instance hash
}

message Object {
    optional string id                                  = 1;    // internal object id (uuid)
    optional string key                                 = 2;    // external object key (cs-string)
    optional string type                                = 3;    // object type name
    optional string display_name                        = 4;    // display name object
    optional google.protobuf.Struct properties          = 5;    // property bag
    optional google.protobuf.Timestamp created_at       = 20;   // created at timestamp (UTC)
    optional google.protobuf.Timestamp updated_at       = 21;   // last updated timestamp (UTC)
    optional google.protobuf.Timestamp deleted_at       = 22;   // deleted timestamp (UTC)
    optional string hash                                = 23;   // object instance hash
}

message Relation {
    ObjectIdentifier subject                            = 1;    // subject identifier
    optional string relation                            = 2;    // relation type ID
    ObjectIdentifier object                             = 3;    // object identifier
    optional google.protobuf.Timestamp created_at       = 20;   // created at timestamp (UTC)
    optional google.protobuf.Timestamp updated_at       = 21;   // last updated timestamp (UTC)
    optional google.protobuf.Timestamp deleted_at       = 22;   // deleted timestamp (UTC)
    optional string hash                                = 23;   // object instance hash
}

message ObjectDependency {
	string  object_type                     = 1;    // object type name of source object
	string  object_id                       = 3;    // object id (uuid) of source object
	string  object_key                      = 4;    // object search key of source object
    string  relation                        = 5;    // relation identifier
    string  subject_type                    = 7;    // object type id of target object 
    string  subject_id                      = 9;    // object id (uuid) of target object
    string  subject_key                     = 10;   // object search key of target object
    int32   depth                           = 11;   // dependency depth
    bool    is_cycle                        = 12;   // dependency cycle
    string  path                            = 13;   // dependency path
}

enum Flag {
    FLAG_UNKNOWN                            = 0x0;  // default, no special object behavior
    FLAG_HIDDEN                             = 0x1;  // hidden object
    FLAG_READONLY                           = 0x2;  // read-only object
    FLAG_SYSTEM                             = 0x4;  // system object
    FLAG_SHADOW                             = 0x8;  // shadow object by type+key assosciated to parent object
}

// ObjectType identifier
message ObjectTypeIdentifier {
    optional int32 id                                   = 1;    // internal object type id
    optional string name                                = 2;    // object type name (unique, lc-string)
}

// Permission identifier
message PermissionIdentifier {
    optional string id                                  = 1;    // internal permission id
    optional string name                                = 2;    // permission name (unique, cs-string)
}

// RelationType identifier
message RelationTypeIdentifier {
    optional int32 id                                   = 1;    // relation type id selector
    optional string name                                = 2;    // relation type name selector
    optional string object_type                         = 3;    // object type referenced by relation
}

// Object identifier 
message ObjectIdentifier {
    optional string id                                  = 1;    // internal object id (uuid)
    optional string key                                 = 2;    // external object key (cs-string)
    optional string type                                = 3;    // object type
}

// Relation identifier
message RelationIdentifier {
    ObjectIdentifier subject                            = 1;    // subject identifier
    optional string relation                            = 2;    // relation type ID
    ObjectIdentifier object                             = 3;    // object identifier
}
