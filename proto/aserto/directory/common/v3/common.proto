syntax = "proto3";

package aserto.directory.common.v3;

import "google/api/field_behavior.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/aserto-dev/go-directory/aserto/directory/common/v3;common";

// manifest type
message Manifest {
  // Manifest payload
  bytes body = 1;
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // manifest instance etag
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

message Model {
  // Model representation of manifest
  google.protobuf.Struct model = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // manifest instance etag
  string etag = 23 [(google.api.field_behavior) = OUTPUT_ONLY];
}

message Object {
  reserved 3, 20;
  reserved "type", "id", "display_name", "created_at";
  // object type name
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // external object identifier (cs-string, no spaces or tabs)
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // property bag
  google.protobuf.Struct properties = 4 [(google.api.field_behavior) = OPTIONAL];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // object instance etag
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

message Relation {
  reserved 20;
  reserved "created_at";
  // object type
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // object relation name
  string relation = 3 [(google.api.field_behavior) = REQUIRED];
  // subject type
  string subject_type = 4 [(google.api.field_behavior) = REQUIRED];
  // subject identifier
  string subject_id = 5 [(google.api.field_behavior) = REQUIRED];
  // optional subject relation name
  string subject_relation = 6 [(google.api.field_behavior) = OPTIONAL];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // object instance etag
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

// object identifier
message ObjectIdentifier {
  reserved "type", "id";
  // object type name
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // external object identifier (cs-string, no spaces or tabs)
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
}

// relation identifier
message RelationIdentifier {
  // object type
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // object relation name
  string relation = 3 [(google.api.field_behavior) = REQUIRED];
  // subject type
  string subject_type = 4 [(google.api.field_behavior) = REQUIRED];
  // subject identifier
  string subject_id = 5 [(google.api.field_behavior) = REQUIRED];
  // optional subject relation name
  string subject_relation = 6 [(google.api.field_behavior) = OPTIONAL];
}

// pagination request
message PaginationRequest {
  // requested page size, valid value between 1-100 rows (default 100)
  int32 size = 1 [(google.api.field_behavior) = OPTIONAL];
  // pagination start token, default ""
  string token = 2 [(google.api.field_behavior) = OPTIONAL];
}

// pagination response
message PaginationResponse {
  // next page token, when empty there are no more pages to fetch
  string next_token = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
}
