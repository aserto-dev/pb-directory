syntax = "proto3";

package aserto.directory.common.v4;

import "google/api/field_behavior.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/aserto-dev/go-directory/aserto/directory/common/v4;common";

// Manifest
message Manifest {
  // manifest payload
  bytes body = 1;
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // manifest instance etag  (optional)
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

// Model
message Model {
  // model representation of manifest
  google.protobuf.Struct model = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // manifest instance etag
  string etag = 23 [(google.api.field_behavior) = OUTPUT_ONLY];
}

// Object
message Object {
  // object type identifier
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object instance identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // property bag (optional)
  google.protobuf.Struct properties = 4 [(google.api.field_behavior) = OPTIONAL];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // object instance etag (optional)
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

// Relation
message Relation {
  // object type identifier
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object instance identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // object relation name
  string relation = 3 [(google.api.field_behavior) = REQUIRED];
  // subject type identifier
  string subject_type = 4 [(google.api.field_behavior) = REQUIRED];
  // subject instance identifier
  string subject_id = 5 [(google.api.field_behavior) = REQUIRED];
  // subject relation name (optional)
  string subject_relation = 6 [(google.api.field_behavior) = OPTIONAL];
  // last updated timestamp (UTC)
  google.protobuf.Timestamp updated_at = 21 [(google.api.field_behavior) = OUTPUT_ONLY];
  // object instance etag (optional)
  string etag = 23 [(google.api.field_behavior) = OPTIONAL];
}

// Object identifier
message ObjectIdentifier {
  // object type identifier
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object instance identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
}

// Relation identifier
message RelationIdentifier {
  // object type identifier
  string object_type = 1 [(google.api.field_behavior) = REQUIRED];
  // object instance identifier
  string object_id = 2 [(google.api.field_behavior) = REQUIRED];
  // object relation name
  string relation = 3 [(google.api.field_behavior) = REQUIRED];
  // subject type identifier
  string subject_type = 4 [(google.api.field_behavior) = REQUIRED];
  // subject instance identifier
  string subject_id = 5 [(google.api.field_behavior) = REQUIRED];
  // subject relation name (optional)
  string subject_relation = 6 [(google.api.field_behavior) = OPTIONAL];
}

// Pagination request
message PaginationRequest {
  // requested page size, valid value between 1-1000 rows (optional, default 100)
  int32 size = 1 [(google.api.field_behavior) = OPTIONAL];
  // pagination start token (optional default "")
  string token = 2 [(google.api.field_behavior) = OPTIONAL];
}

// Pagination response
message PaginationResponse {
  // next page token, when empty there are no more pages to fetch
  string next_token = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
}
