syntax = "proto3";

package aserto.directory.model.v3;

option go_package = "github.com/aserto-dev/go-directory/aserto/directory/model/v3;model"; 

import "google/api/field_behavior.proto";
import "google/protobuf/empty.proto";

import "aserto/directory/common/v3/common.proto";

service Model {
    rpc GetManifest(GetManifestRequest) returns (stream GetManifestResponse) {};
    rpc SetManifest(stream SetManifestRequest) returns (SetManifestResponse) {};
    rpc DeleteManifest(DeleteManifestRequest) returns (DeleteManifestResponse) {};
    rpc ListManifests(ListManifestsRequest) returns (ListManifestsResponse) {};
}

message GetManifestRequest {
    // manifest name (unique, lc-string)
    string name                                                 = 1     [(google.api.field_behavior) = REQUIRED];
    // manifest version (semver notation)
    string version                                              = 2     [(google.api.field_behavior) = REQUIRED];
}

message GetManifestResponse {
    oneof msg {
        // Manifest metadata
        Metadata metadata                                       = 1;
        // Manifest content
        bytes   body                                            = 2;
    }
}

message SetManifestRequest {
    oneof msg {
        // Manifest metadata
        Metadata metadata                                       = 1;
        // Manifest content
        bytes   body                                            = 2;
    }
}

message SetManifestResponse {
    // empty result
    google.protobuf.Empty result                                = 1;
}


message DeleteManifestRequest {
    // manifest name (unique, lc-string)
    string name                                                 = 1     [(google.api.field_behavior) = REQUIRED];
    // manifest version (semver notation)
    string version                                              = 2     [(google.api.field_behavior) = REQUIRED];
}

message DeleteManifestResponse {
    // empty result
    google.protobuf.Empty result                                = 1;
}

message ListManifestsRequest {
    // pagination request
    aserto.directory.common.v3.PaginationRequest page_request   = 1;
}

message ListManifestsResponse {
    // manifests metadata
    repeated Metadata manifests                                 = 1;
    // pagination response
    aserto.directory.common.v3.PaginationResponse next_page     = 2;
}

message Metadata {
    // manifest name (unique, lc-string)
    string  name                                                = 1      [(google.api.field_behavior) = REQUIRED];
    // manifest version (semver notation)
    string  version                                             = 2      [(google.api.field_behavior) = REQUIRED];
}
